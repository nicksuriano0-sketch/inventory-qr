{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Your Inventory</h2>
    <a href="{{ url_for('add_item') }}" class="btn btn-primary">Add New Fitting</a>
  </div>

  <!-- Search Bar -->
  <div class="input-group mb-3">
    <span class="input-group-text">üîç</span>
    <input
      type="text"
      id="searchInput"
      class="form-control"
      placeholder="Search fittings by name or category..."
    />
  </div>

  <!-- Inventory Table -->
  <table class="table table-striped" id="fittingsTable">
    <thead class="table-dark">
      <tr>
        <th>Name</th>
        <th>Category</th>
        <th>Quantity</th>
        <th>QR</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for f in fittings %}
      <tr>
        <td>{{ f.fitting_name or f.name }}</td>
        <td>{{ f.category }}</td>
        <td>{{ f.quantity or 0 }}</td>
        <td>
          {% if f.qr_code %}
            <img src="data:image/png;base64,{{ f.qr_code }}" width="80" alt="QR Code" />
          {% else %}
            <span class="text-muted">No QR</span>
          {% endif %}
        </td>
        <td>
          <a
            href="{{ url_for('scan', name=f.fitting_name or f.name) }}"
            class="btn btn-sm btn-outline-primary"
            >View / Adjust</a
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Live Search Script -->
<script>
  const searchInput = document.getElementById("searchInput");
  const table = document.getElementById("fittingsTable");
  const rows = table.getElementsByTagName("tr");

  searchInput.addEventListener("keyup", function () {
    const query = this.value.toLowerCase();
    for (let i = 1; i < rows.length; i++) {
      const name = rows[i].cells[0]?.textContent.toLowerCase() || "";
      const category = rows[i].cells[1]?.textContent.toLowerCase() || "";
      if (name.includes(query) || category.includes(query)) {
        rows[i].style.display = "";
      } else {
        rows[i].style.display = "none";
      }
    }
  });
</script>
{% endblock %}
